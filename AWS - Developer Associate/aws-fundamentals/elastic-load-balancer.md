# Elastic Load Balancer

	- Sticky Sessions
		- The same client is always redirected to the same instance behind a load balancer
		- Works for CLB and ALB
		- The cookie user for stickiness has an expiration date you control
		- Use case: make sure the user doesn't lose his session data
		- Enabling it, may bring imbalance to the load over the backend EC2 instances

		- Cookie Names 
			- Application-based Cookies
				- Custom cookie: generated by target, can include any custom attributes required by the application
				- Application cookie: generated by load balancer, cookie name is AWSALBAPP
			
			- Duration-based Cookies
				- Generated by the load balancer
				- Cookie name is AWSALB for ALB, AWSELB for CLB 

	- Cross-Zone Load Balancing
		- With Cross Zone:
			- Each load balancer instance distributes evenly across all registered instances in all AZ
		
		- Without Cross Zone: 
			- Requests are distributed in the instances of the node of the ELB

		- ALB (Application)
			- Always on (can't be disabled)
			- No charges for inter AZ data
		
		- NLB (Network)
			- Disabled for default
			- You pay charges for inter AZ data if enable

		- CLB (Classic)
			- Disabled by default 
			- No charges for inter AZ data if enabled
	
	- SSL / TLS - Basics
		- SSL Certificate allows traffic between your clients and your load balancer to be encrypted in transit

		- SSL refers to Secure Sockets Layer, used to encrypt connections
		- TLS refers to Transport Layer Security, which is a newer version
		- TLS certificates are mainly used

		- LB uses an X.509 certificate
		- You can manage certificates using ACM (AWS Certificate Manager)
		- You can create, upload your own certificates alternatively
		- HTTPS listener: 
			- Must specify a default certificate
			- Can add an optional list of certs to support multiple domains
			- Clients can use SNI (Server Name Indication) to specify the hostname they reach
			- Ability to specify a security policy to support older versions of SSL/TLS (legacy clients)
		
		- SNI solves the problem of multiple SSL certificates into one web server (to serve multiple websites)
		- It is a newer protocol and requeries the client to indicate the hostname of the target server in the initial SSL handshake
		- The server will the find the correct certificate, or return the default one

		- Only works for ALB and NLB, CloudFront
		- Does not work for CLB

		- CLB (Classic)
			- Support only one SSL
			- Must use multiple CLB for multiple hostname with multiple SSL certificates
		
		- ALB (Application)
			- Supports multiple listeners with multiple SSL certificates
			- Uses Server Name Indication (SNI) to make it work
		
		- NLB (Network)
			- Supports multiple listeners with multiple SSL certificates
			- Uses Server Name Indication (SNI) to make it work
	
	- Connection Draining (CLB)
		- Connection Draining for CLB
		- Deregistration Delay for ALB and NLB

		- Time to complete in-flight request while the instance is de-registering or unhealthy
		- Stops sending new requests to the EC2 instance which is de-registering
		- You can set between 1 to 3600 seconds
		- Can be disabled (set value to 0)
		- Set to a low value if your request are short

